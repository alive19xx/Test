@using System.Web.Mvc
@model Restaurant.Web.ViewModels.OrderForm.OrderFormViewModel
@{
    ViewBag.Title = "Create";
}

<h2>Create</h2>
@using (Html.BeginForm("Create", "Orders"))
{
    @Html.ValidationSummary(true)
    <div class="form-group">
        @Html.LabelFor(m => m.TableNumber, new { @class = "control-label" })
        @Html.TextBoxFor(x => x.TableNumber, new { @class = "form-control" })
    </div>



    <div class="panel panel-primary">
        <div class="panel-heading">
            <button id="add-order-item-button" type="button" class="btn btn-success">Add Item</button>
            @{
                var selectMenuItems = new List<SelectListItem>();
                foreach (var item in ViewBag.Menu)
                {
                    selectMenuItems.Add(new SelectListItem { Text = item.Name, Value = item.Id.ToString() });
                }
            }
            @Html.DropDownList("Menu items", new SelectList(selectMenuItems, "Value", "Text"), new { id = "menu-dropdown", @class = "form-control", style = "display:inline-block" })

        </div>

        <table id="order-items-table" class="table table-striped">
            <thead><tr><th>Menu Item</th> <th>Number of portions</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    @Html.AntiForgeryToken()

    <button type="submit" class="btn btn-primary">Save</button>
    @Html.ActionLink("Cancel", "Index", null, new { @class = "btn btn-default" })
}








@section scripts
{
    <script>
        $(document).ready(function() {
            $("#add-order-item-button").click(function() {
                //$("#order-items-table tbody").append("afsfdaf");
                addNewItem($("#order-items-table tbody"),
                    $("#menu-dropdown").val(),
                    $("#menu-dropdown :selected").text(),
                    $("#order-items-table tbody tr.order-item").length);
            });
        });


        function addNewItem(tableBody, menuItemId, menuItemName, itemIndex) {
            console.log(menuItemId);
            var template = [
                '<tr class="order-item">',
                '<td>',
                '<div>',
                `<span>${menuItemName}</span>`,
                '</div>',
                '</td >',
                '<td>',
                `<input type="hidden" value="${menuItemId}" name="OrderItems[${itemIndex}].MenuItemId" />`,
                `<input type="number" value="1" min="0" name="OrderItems[${itemIndex}].NumberOfItems" />`,
                '</td>',
                '</tr >'
            ].join("\n");
            $(tableBody).append(template);
        }
    </script>
}